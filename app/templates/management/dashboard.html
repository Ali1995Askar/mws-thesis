{% extends "dashboard-base.html" %}
{% load static %}

{% block content %}

    <main id="main" class="main">


        <div class="pagetitle">
            <h1>Dashboard</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href={% url 'home' %}>Home</a></li>
                    <li class="breadcrumb-item active">Dashboard</li>
                </ol>
            </nav>
        </div><!-- End Page Title -->

        <section class="section dashboard">
            <div class="row">
                <!-- Workers Card -->
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card sales-card">
                        <div class="card-body">
                            <h5 class="card-title">Workers<span></span></h5>
                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <a href={% url 'workers:list' %}> <i class="bi bi-person-badge-fill"></i></a>
                                </div>
                                <div class="ps-3">
                                    <h6>{{ workers_count }}</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Workers Card -->

                <!-- Tasks Tasks -->
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card revenue-card">
                        <div class="card-body">
                            <h5 class="card-title">Tasks <span></span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <a href={% url 'tasks:list' %}><i class="bi bi-wrench-adjustable"></i></a>
                                </div>
                                <div class="ps-3">
                                    <h6>{{ tasks_count }}</h6>
                                </div>

                            </div>
                        </div>

                    </div>
                </div><!-- End Tasks Card -->

                <!-- Departments Card -->


                <!-- Positions Card -->
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card sales-card">
                        <div class="card-body">
                            <h5 class="card-title">Categories<span></span></h5>
                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <a href={% url 'categories:list' %}> <i class="bi bi-tags-fill"></i></a>


                                </div>
                                <div class="ps-3">
                                    <h6>{{ categories_count }}</h6>

                                </div>

                            </div>

                        </div>

                    </div>
                </div><!-- End Positions Card -->

            </div>
            <div class="row">
                <div class="col-xxl-8 col-md-12">
                    <div class="card top-selling overflow-auto">
                        <div class="card-body pb-0">
                            <h5 class="card-title">Top 5 Workers <span>| This month</span></h5>
                            <table class="table table-borderless">
                                <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">Full Name</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Education</th>
                                    <th scope="col">Level</th>
                                    <th scope="col">Status</th>

                                </tr>
                                </thead>
                                <tbody>

                                {% for worker in top_5_workers %}
                                    <tr>
                                        <th scope="row">
                                            <a href="#"><img src="{% static 'img/worker-icon.png' %}" alt=""></a>
                                        </th>
                                        <td class="text-primary fw-bold">{{ worker.full_name }}</td>
                                        <td>{{ worker.email }}</td>
                                        <td>{{ worker.education }}</td>
                                        <td>{{ worker.level }}</td>
                                        <td>
                                            {% if worker.status == "OCCUPIED" %}
                                                <span class="badge bg-success">
                                            {% elif worker.status == "FREE" %}
                                                <span class="badge bg-danger">
                                            {% endif %}
                                            {{ worker.status }}
                                            </span>
                                        </td>

                                    </tr>
                                {% endfor %}


                                </tbody>
                            </table>

                        </div>

                    </div>
                </div>
                <div class="col-xxl-4 col-md-12">
                    <!-- Website Traffic -->
                    <div class="card">

                        <div class="card-body pb-0">
                            <h5 class="card-title">Tasks Per Category<span></span></h5>

                            <div id="pieChart" style="min-height: 400px;" class="echart"></div>

                            <script>
                                let tasksJsonString = '{{ tasks_per_category|escapejs|safe }}';
                                let tasksParsedData = JSON.parse(tasksJsonString);
                                let tasksData = [];
                                let tasksLabels = [];
                                for (let key in tasksParsedData) {
                                    tasksLabels.push(key);
                                    tasksData.push(tasksParsedData[key]);
                                }

                                document.addEventListener("DOMContentLoaded", () => {
                                    new ApexCharts(document.querySelector("#pieChart"), {
                                        series: tasksData,
                                        chart: {
                                            height: 350,
                                            type: 'pie',
                                            toolbar: {
                                                show: true
                                            }
                                        },
                                        labels: tasksLabels
                                    }).render();
                                });
                            </script>

                        </div>
                    </div><!-- End Website Traffic -->
                </div>
            </div>
            <div class="row">
                <div class="col-xxl-8 col-md-12">
                    <div class="card top-selling overflow-auto">
                        <div class="card-body pb-0">
                            <h5 class="card-title"> Most 10 Requested Categories <span>| This Year</span></h5>
                            <table class="table table-borderless">
                                <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Tasks Count</th>
                                    <th scope="col">Employees Count</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for category in top_10_categories %}
                                    <tr>
                                        <th scope="row">
                                            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                                <i class="bi bi-tags-fill"></i>
                                            </div>
                                        </th>
                                        <td class="text-primary fw-bold fs-5">{{ category.name }}</td>
                                        <td class="fs-5">{{ category.number_of_tasks }}</td>
                                        <td class="fs-5">{{ category.total_employees }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-4 col-md-12">
                    <div class="card">
                        <div class="card-body">
                            {{ tasks_per_category.software }}

                            <h5 class="card-title">Workers Per Categories</h5>
                            <div id="barChart"></div>
                            <script>
                                let workersJsonString = '{{ workers_per_category|escapejs|safe }}';
                                let workersParsedData = JSON.parse(workersJsonString);

                                let workersData = [];
                                let workersCategories = [];
                                for (let key in workersParsedData) {
                                    workersCategories.push(key);
                                    workersData.push(workersParsedData[key]);
                                }


                                document.addEventListener("DOMContentLoaded", () => {
                                    new ApexCharts(document.querySelector("#barChart"), {
                                        series: [{
                                            data: workersData
                                        }],
                                        chart: {
                                            type: 'bar',
                                            height: 350
                                        },
                                        plotOptions: {
                                            bar: {
                                                borderRadius: 4,
                                                horizontal: true,
                                            }
                                        },
                                        dataLabels: {
                                            enabled: false
                                        },
                                        xaxis: {
                                            categories: workersCategories,
                                        }
                                    }).render();
                                });
                            </script>
                        </div>
                    </div>
                </div>
            </div>

        </section>

    </main><!-- End #main -->


{% endblock content %}
